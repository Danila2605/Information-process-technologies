<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Моделирование характеристик хранилищ данных</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjs@11.11.0/lib/browser/math.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ode.js@1.0.0/ode.min.js"></script>
    <style>
        .chart-wrapper {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .chart-wrapper.full-width {
            width: 100%;
        }

        .chart-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .chart-subtitle {
            color: #666;
            margin-bottom: 10px;
        }
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            margin: 0;
            padding: 20px;
            background-color: #f5f9ff;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #1a4b8c;
            margin-bottom: 10px;
            border-bottom: 2px solid #1a4b8c;
            padding-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #555;
            margin-bottom: 30px;
            font-style: italic;
        }
        
        .section {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #1a4b8c;
        }
        
        h2 {
            color: #1a4b8c;
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #e8f1ff;
            color: #1a4b8c;
            font-weight: 600;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }
        
        input:focus {
            border-color: #1a4b8c;
            outline: none;
            box-shadow: 0 0 0 2px rgba(26, 75, 140, 0.2);
        }
        
        .button-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 24px;
            background-color: #1a4b8c;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #0d3a73;
        }
        
        button.secondary {
            background-color: #4a6fa5;
        }
        
        button.secondary:hover {
            background-color: #3a5a8c;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
        }
        
        .chart-wrapper {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .chart-title {
            text-align: center;
            font-weight: 600;
            margin-bottom: 10px;
            color: #1a4b8c;
        }
        
        .info-text {
            background-color: #e8f4ff;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #1a4b8c;
        }
        
        .function-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
        }
        
        .function-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            font-family: monospace;
        }
        
        .function-item:last-child {
            border-bottom: none;
        }
        
        .highlight {
            background-color: #fff9e6;
            padding: 3px 5px;
            border-radius: 3px;
            font-weight: 600;
        }
        .chart-subtitle {
            text-align: center;
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }
        
        @media (max-width: 1200px) {
            .charts-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .button-container {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Моделирование показателей авиационо-транспортнной системы</h1>
        <div class="subtitle">Ввод показателей и визуализация динамики показателей X<sub>1</sub>-X<sub>10</sub></div>
                
        <!-- Таблица 1: Вводимые значения Xn -->
        <div class="section">
            <h2>Таблица 1: Начальные условия X<sub>n</sub></h2>
            <p>Введите начальные условия показателей X<sub>n</sub></p>
            <table id="table1">
                <thead>
                    <tr>
                        <th>Характеристика</th>
                        <th>Описание</th>
                        <th>Начальное значение X<sub>n</sub></th>
                    </tr>
                </thead>
                <tbody id="table1-body">
                    <!-- Данные будут сгенерированы JavaScript -->
                </tbody>
            </table>
        </div>
              
        <!-- Таблица 3: Функции -->
        <div class="section">
            <h2>Таблица 2: Коэффициенты функций f(x) = a*x³ + b*x² + c*x + d</h2>
            <p>Введите коэффициенты для 36 функций, используемых в модели.</p>
            <table id="table3">
                <thead>
                    <tr>
                        <th>Функция</th>
                        <th>Коэффициент a</th>
                        <th>Коэффициент b</th>
                        <th>Коэффициент c</th>
                        <th>Коэффициент d</th>
                    </tr>
                </thead>
                <tbody id="table3-body">
                    <!-- Данные будут сгенерированы JavaScript -->
                </tbody>
            </table>
        
        </div>
        
        <div class="section">
            <table id="table4">
                <thead>
                    <tr>
                        <th>Параметр</th>
                        <th>Максимальное ограничение</th>
                    </tr>
                </thead>
                <tbody id="table4-body">
                    <!-- Данные будут сгенерированы JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Кнопки управления -->
        <div class="button-container">
            <button id="calculate-btn">Рассчитать динамику показателей</button>
            <button id="reset-btn" class="secondary">Сбросить значения по умолчанию</button>
            <button id="random-btn" class="secondary">Заполнить случайными значениями</button>
        </div>
        
        <!-- Графики -->
        <div class="section">
            <h2>Динамика характеристик X<sub>n</sub> в 6 временных точках</h2>
            <p>Лепестковые графики показывают значения характеристик X<sub>1</sub>-X<sub>10</sub> в 6 моментов времени (t=0, t=0.2, t=0.4, t=0.6, t=0.8, t=1)</p>
            <div class="charts-container" id="charts-container">
                <!-- Графики будут сгенерированы JavaScript -->
            </div>
        </div>

        <canvas id="myChart" width="600" height="300"></canvas>

        <!-- Описание уравнений -->
        <div class="section">
            <h2>Уравнения изменений характеристик X<sub>n</sub></h2>
            <p>Общий вид уравнений, характеризующих изменение характеристик во времени:</p>
            <ul>
                <li><span class="highlight">X₁(t)</span> - число авиационных катастроф в год</li>
                <li><span class="highlight">X₂(t)</span> - доля воздушных судов старше 15 лет процентов в год</li>
                <li><span class="highlight">X₃(t)</span> - количество нарушений и ошибок пилотов в год</li>
                <li><span class="highlight">X₄(t)</span> - количество проданных авиабилетов в год</li>
                <li><span class="highlight">X₅(t)</span> - влияние человеческого фактора в происшествиях в процентах в год</li>
                <li><span class="highlight">X₆(t)</span> - влияние технического фактора в происшествиях в процентах в год</li>
                <li><span class="highlight">X₇(t)</span> - среднее время тренировок на сертифицированных тренажерах дней в год</li>
                <li><span class="highlight">X₈(t)</span> - показатель активности органов контроля за оборотом контрафакта</li>
                <li><span class="highlight">X₉(t)</span> - повторяемость причин происшествий</li>
                <li><span class="highlight">X₁₀(t)</span> - Объем закупок новых самолетов в год</li>
            </ul>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Описания характеристик Xn
            const xnDescriptions = [
                "число авиационных катастроф в год",
                "доля воздушных судов старше 15 лет процентов в год",
                "количество нарушений и ошибок пилотов в год",
                "количество проданных авиабилетов в год", 
                "влияние человеческого фактора в происшествиях в процентах в год",
                "влияние технического фактора в происшествиях в процентах в год",
                "среднее время тренировок на сертифицированных тренажерах дней в год",
                "показатель активности органов контроля за оборотом контрафакта",
                "повторяемость причин происшествий",
                "Объем закупок новых самолетов в год" 
            ];
            
            // Описания констант
            const constants = [
                {name: "(Price)", description: "стоимость авиатоплива"},
                {name: "(For)", description: "доля иностранных самолетов"},
                {name: "(Dol)", description: "валютный курс доллара"},
                {name: "(Law)", description: "количество нормативно-правовых актов,относящихся к авиации"},
                {name: "(Covid)", description: "Короновирусные ограничения"}
            ];
            
            // Инициализация данных
            let table1Data = [];
            let table2Data = [];
            let table3Data = [];
            let table4Data = [];
            
            // Инициализация данных по умолчанию
            function initDefaultData() {
                // Таблица 1: Начальные и максимальные значения Xn
                table1Data = [];
                for (let i = 1; i < 11; i++) {
                    table1Data.push({
                        id: i,
                        initial: i <= 10 ? (0.5 + Math.random() * 0.3).toFixed(2) : "0.00",
                        max: (0.8 + Math.random() * 0.2).toFixed(2)
                    });
                }
                // Таблица 2: Значения возмущения
                table2Data = [];
                constants.forEach((constant, index) => {
                    table2Data.push({
                        name: constant.name,
                        value: (Math.random() * 0.3).toFixed(2)
                    });
                });
                
                // Таблица 3: Коэффициенты функций
                table3Data = [];
                for (let i = 1; i <= 150; i++) {
                    table3Data.push({
                        id: i,
                        a: (Math.random() * 0.8).toFixed(3),
                        b: (Math.random() * 0.8).toFixed(3),
                        c: (Math.random() * 0.8).toFixed(3),
                        d: (Math.random()).toFixed(3)
                    });
                }
                // Таблица 4:
                table4Data = [];
                for (let i = 0; i < 10; i++) {
                    table4Data.push({
                        id: i,
                        name: "X" + (i+1),
                        max: (0.8 + Math.random() * 0.2).toFixed(4),
                        min: (Math.random() * 0.2).toFixed(4)
                    });
                }
                
                
                renderTables();
            }
            
            // Заполнение случайными значениями
            function fillRandomData() {
                // Таблица 1
                table1Data.forEach(item => {
                    item.initial = (0.5 + Math.random() * 0.3).toFixed(2);
                    item.max = (0.7 + Math.random() * 0.3).toFixed(2);
                });
                console.log(table1Data)

                // Таблица 3
                table3Data.forEach(item => {
                    item.a = (Math.random() * 0.8).toFixed(3);
                    item.b = (Math.random() * 0.8).toFixed(3);
                    item.c = (Math.random() * 0.8).toFixed(3);
                    item.d = (Math.random() * 0.8).toFixed(3);
                });
                // Таблица 4
                for (let i = 0; i < 10; i++) {
                    table4Data.push({
                        id: i,
                        name: "X" + (i),
                        max: (0.8 + Math.random() * 0.2).toFixed(4),
                        min: (Math.random() * 0.2).toFixed(4)
                    });
                }
                
                renderTables();
            }
            
            // Рендер таблиц
            function renderTables() {
                // Таблица 1
                const table1Body = document.getElementById('table1-body');
                table1Body.innerHTML = '';
                
                table1Data.forEach((item, index) => {
                    const row = document.createElement('tr');
                    
                    const descIndex = Math.min(index, xnDescriptions.length - 1);
                    
                    row.innerHTML = `
                        <td>X<sub>${item.id}</sub></td>
                        <td>${xnDescriptions[descIndex]}</td>
                        <td><input type="number" step="0.01" min="0" max="1" class="xn-input" data-index="${index}" data-type="initial" value="${item.initial}"></td>
                    `;
                    
                    table1Body.appendChild(row);
                });
                
                                
                // Таблица 3
                const table3Body = document.getElementById('table3-body');
                table3Body.innerHTML = '';
                let fig = ["₁","₂","₃","₄","₅","₆","₇","₈","₉","₁₀"];
                // Показываем все вспомогательные функции в таблице
                for (let i = 0; i < 36; i++) {
                    const item = table3Data[i];
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>f<sub>${item.id}</sub>(x${fig[i%10]}) = </td>
                        <td><div style="display: flex; align-items: center; gap: 4px;">
                            <input type="number" step="0.001" min="0" max="10" class="func-input" style="width: 150px" 
                                data-index="${i}" data-coeff="a" value="${item.a}">
                            <div>·x${fig[i%10]}³ + </div>
                        </div></td>
                        <td><div style="display: flex; align-items: center; gap: 4px;">
                            <input type="number" step="0.001" min="0" max="10" class="func-input" style="width: 150px" 
                                data-index="${i}" data-coeff="a" value="${item.b}">
                            <div>·x${fig[i%10]}² + </div>
                        </div></td>
                        <td><div style="display: flex; align-items: center; gap: 4px;">
                            <input type="number" step="0.001" min="0" max="10" class="func-input" style="width: 150px" 
                                data-index="${i}" data-coeff="a" value="${item.c}">
                            <div>·x${fig[i%10]} + </div>
                        </div></td>
                        <td><div style="display: flex; align-items: center; gap: 4px;">
                            <input type="number" step="0.001" min="0" max="10" class="func-input" style="width: 150px" 
                                data-index="${i}" data-coeff="a" value="${item.d}">
                            <div></div>
                        </div></td>
                    `;
                    
                    table3Body.appendChild(row);
                }

                // Таблица 4
                const table4Body = document.getElementById('table4-body');
                table4Body.innerHTML = '';
                
                for (let i=0;i<10;i++){
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${table4Data[i].name}</td>
                        <td><div style="display: flex; align-items: center; gap: 4px;">
                            <input type="number" step="0.001" min="0" max="10" class="max-input" style="width: 150px" 
                        data-index="${i}" data-coeff="a" value="${table4Data[i].max}"></td>
                    `;
                    
                    table4Body.appendChild(row);
                };
                
                // Добавляем обработчики событий для инпутов
                addEventListeners();
            }
            
            // Добавление обработчиков событий
            function addEventListeners() {
                // Обработчики для таблицы 1
                document.querySelectorAll('.xn-input').forEach(input => {
                    input.addEventListener('change', function() {
                        const index = parseInt(this.dataset.index);
                        const type = this.dataset.type;
                        table1Data[index][type] = this.value;
                    });
                });
                
                // Обработчики для таблицы 2
                document.querySelectorAll('.const-input').forEach(input => {
                    input.addEventListener('change', function() {
                        const index = parseInt(this.dataset.index);
                        table2Data[index].value = this.value;
                    });
                });
                
                // Обработчики для таблицы 3
                document.querySelectorAll('.func-input').forEach(input => {
                    input.addEventListener('change', function() {
                        const index = parseInt(this.dataset.index);
                        const coeff = this.dataset.coeff;
                        table3Data[index][coeff] = this.value;
                    });
                });

                // Обработчики для таблицы 4
                document.querySelectorAll('.max-input').forEach(input => {
                    input.addEventListener('change', function() {
                        const index = parseInt(this.dataset.index);
                        table4Data[index].max = this.value;
                    });
                });
                document.querySelectorAll('.min-input').forEach(input => {
                    input.addEventListener('change', function() {
                        const index = parseInt(this.dataset.index);
                        table4Data[index].min = this.value;
                    });
                });
            }

            function FValue(n,x){
                // Проверка входных данных
                if (x === undefined || x === null || isNaN(x)) {
                    console.warn(`Invalid x value for F: ${x}`);
                    return 1; // нейтральное значение
                }
                
                // логика вычисления f(index, x)
                let result = parseFloat(table3Data[n].a * x * x * x + table3Data[n].b * x * x + table3Data[n].c * x + table3Data[n].d)
                
                // Защита от проблем
                if (isNaN(result) || !isFinite(result)) {
                    console.warn(`NaN/Infinity in F${n}(${x}), returning 1`);
                    return 1;
                }
                
                // Ограничение диапазона
                // if (result < 1e-10) result = 1e-10;
                // if (result > 1e10) result = 1e10;
                
                return result;
            }

            

            // Расчет значений Xn в временных точках
            function calculateXnValues() {
                
                        
                const xnCount = 10; // X1-X10
                const initialValuesX = table1Data.slice(0, xnCount).map(item => parseFloat(item.initial));
                
                // Дифференциальные функции изменения X1-X10
                function cllculateX1(t, X1, othersArray){
                    return (
                        (price(t) + forFactor(t) + dol(t)) * FValue(0,othersArray[1]) * FValue(1,othersArray[2]) -
                        (covid(t) + law(t)) * FValue(2,othersArray[9]) * FValue(3,othersArray[6]) * FValue(4,othersArray[7])
                    )
                }
                function cllculateX2(t, X2, othersArray){
                    return (
                        dol(t) * FValue(5,othersArray[0]) * FValue(6,othersArray[5]) -
                        FValue(7,othersArray[3]) * FValue(8,othersArray[9])
                    )
                }
                function cllculateX3(t, X3, othersArray){
                    return (
                        forFactor(t) * FValue(9,othersArray[0]) * FValue(10,othersArray[4]) * FValue(11,othersArray[8]) -
                        law(t) * FValue(12,othersArray[6])
                    )
                }
                function cllculateX4(t, X4, othersArray){
                    return (
                        - (price(t) + dol(t) + covid(t)) * FValue(13,othersArray[0])
                    )
                }
                function cllculateX5(t, X5, othersArray){
                    return (
                        forFactor(t) * FValue(14,othersArray[2]) * FValue(15,othersArray[8]) -
                        law(t) * FValue(16,othersArray[6])
                    )
                }
                function cllculateX6(t, X6, othersArray){
                    return (
                        price(t) * FValue(17,othersArray[1]) * FValue(18,othersArray[8]) -
                        law(t) * FValue(19,othersArray[9]) * FValue(20,othersArray[7])
                    )
                }
                function cllculateX7(t, X7, othersArray){
                    return (
                        law(t) * FValue(21,othersArray[3]) * FValue(22,othersArray[5]) * FValue(23,othersArray[7]) * FValue(24,othersArray[8]) -
                        (price(t) + dol(t) + covid(t))
                    )
                }
                function cllculateX8(t, X8, othersArray){
                    return (
                        law(t) - covid(t) * FValue(25,othersArray[0]) * FValue(26,othersArray[2]) * 
                        FValue(27,othersArray[4] * FValue(28,othersArray[3]))
                    )
                }
                function cllculateX9(t, X9, othersArray){
                    return (
                        law(t) - FValue(29,othersArray[0]) * FValue(30,othersArray[5]) * FValue(31,othersArray[8])
                    )
                }
                function cllculateX10(t, X10, othersArray){
                    return (
                        price(t) * FValue(32,othersArray[4]) * FValue(33,othersArray[5]) - 
                        FValue(34,othersArray[6]) * FValue(35,othersArray[7])
                    )
                }
                

                function f_dopri(t, y){
                    return [ cllculateX1(t, y[0], y), cllculateX2(t, y[1], y), cllculateX3(t, y[2], y), cllculateX4(t, y[3], y),
                cllculateX5(t, y[4], y), cllculateX6(t, y[5], y), cllculateX7(t, y[6], y), cllculateX8(t, y[7], y),
                cllculateX9(t, y[8], y), cllculateX10(t, y[9], y)
                ];
                }

                const tol = 1e-6;

                const { solveODE } = math;

                const tspan1 = [0, 1];

                const sol1 = solveODE(f_dopri, tspan1, initialValuesX, { method: 'RK45',tol: 1e-6, firstStep: 0.2, maxStep: 0.2});
                
                console.log(sol1);

                const timePoints = 6;

                const xnOverTime = Array.from({length: timePoints}, () => []);

                let count = 0;

                for (let u = 0;u<sol1.t.length;u++){
                    if ( sol1.t[u] === 0 ||
                    sol1.t[u]> 0.19 && sol1.t[u]<0.22 ||
                    sol1.t[u]> 0.39 && sol1.t[u]<0.42 ||
                    sol1.t[u]> 0.59 && sol1.t[u]<0.62 ||
                    sol1.t[u]>= 0.8
                    )
                    {
                        let val = sol1.y[count]
                        for (let r=0;r<val.length;r++){
                            val[r] = Math.max(val[r], parseFloat(table4Data[r].min))
                            val[r] = Math.min(val[r], parseFloat(table4Data[r].max))
                        }
                        xnOverTime[count] = val;
                        count++;
                        if (count === 5) break
                    }
                }
                for (let u = 0;u<sol1.t.length;u++){
                    if ( sol1.t[u] === 1)
                    {
                        let val = sol1.y[count]
                        for (let r=0;r<val.length;r++){
                            val[r] = Math.max(val[r], parseFloat(table4Data[r].min))
                            val[r] = Math.min(val[r], parseFloat(table4Data[r].max))
                        }
                        xnOverTime[5] = val
                        break
                    }
                }
                
                return xnOverTime;
            }

            /////////////////
           
            let chart;
            
            // Создание лепестковых и линейного графиков
            function createCharts(xnOverTime) {
                if (chart) {
                    chart.destroy(); // Уничтожаем предыдущий график
                }

                let selectedTimes = ['t=0 (начало)', 't=0.2', 't=0.4', 't=0.6', 't=0.8', 't=1']
                const ctx = document.getElementById('myChart').getContext('2d');
                
                // Количество переменных (длина внутреннего массива)
                const varCount = xnOverTime[0].length;

                // названия временных точек
                const labels = selectedTimes;

                // набор цветов (если переменных много — цвета циклически повторяются)
                const colors = [
                    'red', 'blue', 'green', 'orange', 'purple',
                    'brown', 'pink', 'cyan', 'magenta', 'olive',
                    "LightGreen","Aqua","Khaki","SteelBlue"
                ];

                // Формируем наборы данных для Chart.js
                let datasets = [];

                for (let v = 0; v < varCount; v++) {

                    // Берём все значения x_v(t_i) для переменной v
                    const dataV = xnOverTime.map(row => row[v]);

                    datasets.push({
                        label: `X${v+1}(t)`,
                        data: dataV,
                        fill: false,
                        borderColor: colors[v % colors.length],
                        borderWidth: 2,
                        tension: 0.2
                    });
                }

                // Строим график
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'right',
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Время t'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Значение переменных'
                                }
                            }
                        }
                    }
                });


                const chartsContainer = document.getElementById('charts-container');
                chartsContainer.innerHTML = '';
                
                const timeLabels = ['t=0 (начало)', 't=0.2', 't=0.4', 't=0.6', 't=0.8', 't=1'];
                const xnLabels = Array.from({length: 10}, (_, i) => `X${i+1}`);
                
                // Цвета для графиков
                const chartColors = [
                    'rgba(26, 75, 140, 0.7)',
                    'rgba(65, 105, 225, 0.7)',
                    'rgba(70, 130, 180, 0.7)',
                    'rgba(100, 149, 237, 0.7)',
                    'rgba(30, 144, 255, 0.7)',
                    'rgba(90, 144, 255, 0.7)'
                ];
                
                // Создаем 5 графиков для каждого момента времени
                for (let t = 0; t < 6; t++) {
                    const chartWrapper = document.createElement('div');
                    chartWrapper.className = 'chart-wrapper';
                    
                    const chartTitle = document.createElement('div');
                    chartTitle.className = 'chart-title';
                    chartTitle.textContent = timeLabels[t];
                    
                    // Добавляем информацию о максимальных значениях
                    const maxInfo = document.createElement('div');
                    maxInfo.className = 'chart-subtitle';
                    
                    const canvas = document.createElement('canvas');
                    canvas.id = `chart-${t}`;
                    
                    chartWrapper.appendChild(chartTitle);
                    chartWrapper.appendChild(maxInfo);
                    chartWrapper.appendChild(canvas);
                    chartsContainer.appendChild(chartWrapper);
                    
                    // Получаем максимальные значения для каждой характеристики
                    

                    const maxC = []
                    for (let i = 0; i < 10; i++) {
                        maxC.push(parseFloat(table4Data[i].max));
                    }
                    
                    
                    
                  const overallMax = Math.max(...maxC);

                    // Создаем график
                    const ctx = canvas.getContext('2d');
                    new Chart(ctx, {
                        type: 'radar',
                        data: {
                            labels: xnLabels,
                            datasets: [
                                {
                                    label: `Текущие значения X₁-X₁₄`,
                                    data: xnOverTime[t],
                                    backgroundColor: chartColors[t],
                                    borderColor: chartColors[t],//.replace('0.7', '1'),
                                    borderWidth: 2,
                                    pointBackgroundColor: chartColors[t],//.replace('0.7', '1'),
                                    pointRadius: 4
                                },
                                
                                {
                                    label: 'Максимальные ограничения',
                                    data: maxC,
                                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                    borderColor: 'rgba(100, 99, 132, 0.8)',
                                    borderWidth: 1,
                                    borderDash: [5, 5],
                                    pointBackgroundColor: 'rgba(100, 99, 132, 0.8)',
                                    pointRadius: 2,
                                    fill: false
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            scales: {
                                r: {
                                    beginAtZero: true,
                                    max: overallMax,
                                    ticks: {
                                        stepSize: overallMax / 5,
                                        callback: function(value) {
                                            return value.toFixed(2);
                                        }
                                    },
                                    pointLabels: {
                                        font: {
                                            size: 11
                                        },
                                        callback: function(label, index) {
                                            // Добавляем максимальное значение к названию характеристики
                                            return label + ' (max: ' + maxC[index].toFixed(2) + ')';
                                        }
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        font: {
                                            size: 11
                                        }
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const datasetLabel = context.dataset.label;
                                            const index = context.dataIndex;
                                            const value = context.raw;
                                            const maxVal = maxValues[index];
                                            const percent = ((value / maxVal) * 100).toFixed(1);
                                            
                                            if (context.datasetIndex === 0) {
                                                return `${datasetLabel}: ${value.toFixed(3)} (${percent}% от макс.)`;
                                            } else {
                                                return `${datasetLabel}: ${value.toFixed(3)}`;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }
            
            ////
            ////
            // Обработчики кнопок
            document.getElementById('calculate-btn').addEventListener('click', function() {
                const xnOverTime = calculateXnValues();
                createCharts(xnOverTime);
            });
            
            document.getElementById('reset-btn').addEventListener('click', function() {
                initDefaultData();
            });
            
            document.getElementById('random-btn').addEventListener('click', function() {
                fillRandomData();
            });
            
            // Инициализация при загрузке
            initDefaultData();

            function price(t){
                return 0.33 * t * t + 0.26 * t + 0.41
            }
            function forFactor(t){
                return (-16 * t * t - 4 * t + 87)/100
            }
            function dol(t){
                return (-55 * t * t + 100 * t + 29)/ 110
            }
            function covid(t){
                return (6 * t - 5) / 10
            }
            function law(t){
                return (-3 * t * t + 17 * t + 21) /35
            }

            // Автоматический расчет при загрузке
            setTimeout(() => {
                const xnOverTime = calculateXnValues();
                createCharts(xnOverTime);
            }, 500);
        });
    </script>
</body>
</html>